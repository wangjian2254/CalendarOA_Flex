<?xml version="1.0" encoding="utf-8"?>
<airwindow:CWindow xmlns:fx="http://ns.adobe.com/mxml/2009"
		  xmlns:s="library://ns.adobe.com/flex/spark"
		  xmlns:mx="library://ns.adobe.com/flex/mx" xmlns:airwindow="airwindow.*" width="800" height="800" showStatusBar="false"
		  creationComplete="init(null)" xmlns:uicontrol="uicontrol.*" skinClass="skins.WindowChannelSkin">
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
	</fx:Declarations>
	<fx:Script source="../asfile/chatWindowAs.as" />
	<fx:Script>
		<![CDATA[
			import events.CloseContainerEvent;
			
			
			private function init_owner():void{
				chatTitleContainer.addEventListener(MouseEvent.MOUSE_DOWN, pushApp);
			}
			
			
			
			public function pushApp(e:MouseEvent):void {
				if (this.nativeWindow.displayState == NativeWindowDisplayState.NORMAL) {
					this.nativeWindow.startMove();
				}
			}
			
			

			
			override public function closeContainer(e:CloseContainerEvent):void {
				Pomelo.getIns().removeEventListener('onChat', chatHandler);
				Pomelo.getIns().removeEventListener('quiteChannel', quiteChannelHandler);
				Pomelo.getIns().removeEventListener('joinChannel', joinChannelHandler);
				var event:CloseEvent = new CloseEvent(CloseEvent.CLOSE);
				dispatchEvent(event);
			}
		private function showPic(s:Bitmap, defaultfilename:String=""):void{
			var notice:ImageWindow = new ImageWindow();
			notice.transparent = true;
//			notice.type = NativeWindowType.UTILITY;
			notice.systemChrome = NativeWindowSystemChrome.NONE;
			if(chatUser.type == 'p' || chatUser.type == 'g'){
				notice.status = 0;
			}

			notice.imagedata = s;
			notice.imgname = defaultfilename;
			notice.open();
			notice.addEventListener(UploadFileEvent.UPLOAD,function(event:UploadFileEvent):void{
				event.data.ownertype = chatUser.type;
				event.data.ownername = chatUser.name.substr(0,60);
				event.data.ownerpk = chatUser.id;
				proceedWithUpload(event);
			});
		}
			
		]]>
	</fx:Script>
	<fx:Script source="../asfile/uploadfiles.as" />
	<airwindow:layout>
		<s:VerticalLayout gap="2" paddingBottom="10" paddingRight="10" paddingLeft="10" paddingTop="0" />
	</airwindow:layout>
	<s:HGroup id="chatTitleContainer" width="100%" height="41" verticalAlign="middle"  >

		<uicontrol:HeadImage id="head" width="35" height="35"/>
		<s:Label id="nameLabel" textDecoration="underline"  ></s:Label>

		<mx:Spacer width="100%" height="10"/>
		<uicontrol:WindowControlBtn window="{this}">
			
		</uicontrol:WindowControlBtn>

	</s:HGroup>
	<s:HGroup id="horGroup" width="100%" height="100%" gap="8">
		<s:VGroup   width="100%" height="100%" >

			<uicontrol:AddressList id="chatList" borderColor="#d6d6d6"  dataProvider="{chatsArr}" chatChannel="{chatUser}"
								   listItemClick="chatItemClick_handler(event)"
								   itemRenderer="uicontrol.renderer.ChatItemRenderer" width="100%" height="100%">
			</uicontrol:AddressList>

			<!--<s:TextArea id="ti" width="100%" height="50"-->
			<!--paddingTop="10" paddingBottom="5" paddingLeft="5" paddingRight="5"-->
			<!--focusEnabled="true" fontLookup="device"-->
			<!--fontFamily="simsun,MINGLIU"-->
			<!--alignmentBaseline="ideographicCenter"-->
			<!--color="{cp.selectedColor}"-->
			<!--fontWeight="{bBTN.selected?'bold':'normal'}"-->
			<!--fontStyle="{iBTN.selected?'italic':'normal'}"-->
			<!--textDecoration="{uBTN.selected?'underline':'none'}"-->
			<!--fontSize="{ns.value}"-->
			<!--editable="true"-->
			<!--keyUp="pressEnter(event)"-->
			<!--/>-->
			<s:HGroup width="100%" height="41" horizontalAlign="left" verticalAlign="middle" gap="3">
				<mx:ColorPicker id="cp"/>
				<s:Button skinClass="skins.BtnJiePingSkin" buttonMode="true" toolTip="截屏" />
				<s:Button skinClass="skins.BtnTuPianSkin" buttonMode="true" toolTip="上传图片" click="uploadFile('pic')" />
				<s:Button skinClass="skins.BtnWenJianSkin" buttonMode="true" toolTip="传输文件(服务器保存7天)"/>
				<s:Button skinClass="skins.BtnShangChuanSkin" buttonMode="true" toolTip="上传文件(永久保存)"  click="uploadFile('file')" />
				<s:Spacer width="100%">

				</s:Spacer>
				<s:Button id="scheduleButton" label="显示任务" width="100" buttonMode="true" skinClass="skins.Chat2BtnSkin" click="showSchedule()" includeInLayout="{scheduleButton.visible}"  />
				<s:Button id="quiteButton" label="退出讨论组" width="100" buttonMode="true" skinClass="skins.Chat2BtnSkin" click="quiteGroup()" includeInLayout="{quiteButton.visible}"  />
				<s:Button id="memberButton" label="成员管理" width="100" buttonMode="true" skinClass="skins.Chat2BtnSkin" click="memberGroup()" includeInLayout="{memberButton.visible}"  />
				<s:Button id="usersButton" label="创建讨论组" width="100" buttonMode="true" skinClass="skins.Chat2BtnSkin" click="createGroup()" includeInLayout="{usersButton.visible}"  />
			</s:HGroup>
			<s:TextArea  id="ti" height="94" borderColor="#d6d6d6" prompt="{ChatManager.pomelo_online?'回车(Enter)发送':'即时通信服务正在维护中，目前不可用。'}" width="100%"  color="{cp.selectedColor}" enabled="{ChatManager.pomelo_online}" />

			<s:HGroup width="100%" height="44" horizontalAlign="right" verticalAlign="middle">
				<s:Button  label="关闭" color="#ffffff" width="60" skinClass="skins.ChatBtnSkin" buttonMode="true"  height="28" click="{ti.text='';}"  />
				
				<s:Button  label="发送" color="#ffffff" width="60" chromeColor="red" height="28" click="sendBTN_clickHandler()"  />
			</s:HGroup>

		</s:VGroup>

		<uicontrol:AddressList  id="addressList" borderColor="#d6d6d6"  dataProvider="{chatUser.members}"  visible="{bigPanel}" includeInLayout="{bigPanel}"
								doubleClickEnabled="true" doubleClick="chatUserPanel()" toolTip="双击发送信息" listItemClick="listItemClick_handler(event)"
								itemRenderer="uicontrol.renderer.AddressItemRenderer" width="150" height="100%">
		</uicontrol:AddressList>


	</s:HGroup>

</airwindow:CWindow>
