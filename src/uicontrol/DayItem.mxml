<?xml version="1.0" encoding="utf-8"?>
<s:BorderContainer xmlns:fx="http://ns.adobe.com/mxml/2009" 
				   xmlns:s="library://ns.adobe.com/flex/spark" 
				   xmlns:mx="library://ns.adobe.com/flex/mx" width="100" borderVisible="false" height="110" click="createSchedule(event)"  creationComplete="init()" xmlns:uicontrol="uicontrol.*">
	<s:layout>
		<s:VerticalLayout gap="0"/>
	</s:layout>
	<fx:Script>
		<![CDATA[
			import control.SchedulePanel;
			
			import events.ChangeScheduleEvent;
			
			import httpcontrol.HttpServiceUtil;
			
			import mx.collections.ArrayCollection;
			import mx.core.FlexGlobals;
			import mx.events.FlexEvent;
			import mx.managers.PopUpManager;
			import mx.rpc.events.ResultEvent;
			
			import spark.skins.spark.BorderContainerSkin;
			
			import util.DateUtil;
			import util.ToolUtil;
			
			
			[Bindable]
			public var date:String="20140315";
			[Bindable]
			public var nowdate:String="20140315";
			
			private var groupShowData:Object=new Object();
			
			private var scheduleArr:ArrayCollection=new ArrayCollection();
			
			public function init():void{
				if(date.substr(0,6)==nowdate.substr(0,6)){
					this.setStyle("backgroundColor",0xffffff);
					
				}else{
					
					this.setStyle("backgroundColor",0xcccccc);
				}
				if(date==monthstr.format(new Date())){
					this.setStyle("backgroundColor",0xFFCC00);
				}
				getScheduleByDate();
				FlexGlobals.topLevelApplication.addEventListener(ChangeScheduleEvent.ChangeSchedule_EventStr,getScheduleByDate);
			}
			
			private function getScheduleByDate(e:Event=null):void{
				
				scheduleArr.removeAll();
				groupShowData=new Object();
				if(ToolUtil.scheduleMap.hasOwnProperty("schedulelist")&&ToolUtil.scheduleMap.schedulelist.hasOwnProperty(date)){
					for each(var i:String in ToolUtil.scheduleMap.schedulelist[date]){
						
						scheduleArr.addItem(ToolUtil.scheduleMap.schedulemap[i]);
					}
				}
				showSchedule();
			}
			
			private function createSchedule(e:MouseEvent):void{
				if(!(e.target is BorderContainerSkin)){
					return;
				}
				var s:SchedulePanel = PopUpManager.createPopUp(FlexGlobals.topLevelApplication as DisplayObject,SchedulePanel,false) as SchedulePanel;
				s.schedulData = null;
				s.startDateValue = DateUtil.parseDate(date+timestr.format(new Date()));
				s.endDateValue = DateUtil.parseDate(date+timestr.format(new Date()));
				PopUpManager.centerPopUp(s);
			}
			
//			private function queryResult(result:Object,e:ResultEvent):void{
//				scheduleArr.removeAll();
//				if(result.success){
//					
//				}
//				
//				
//			}
			
			public function showSchedule(gid:Number=0,show:Boolean=true):void{
				if(gid!=0){
					groupShowData[gid+""]=show;
				}
				scheduleList.removeAllElements();
				var scheduleItem:ScheduleItem=null;
				for each(var obj:Object in scheduleArr){
					scheduleItem = new ScheduleItem();
					scheduleItem.scheduleData = obj;
					scheduleItem.scheduleName = obj.title;
					scheduleItem.color = obj.color;
					scheduleItem.scheduleId = obj.id;
					if(!groupShowData.hasOwnProperty(""+gid)||groupShowData[""+gid]){
						scheduleList.addElement(scheduleItem);
					}
				}
			}
			
			
			
		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
		<mx:DateFormatter id="monthstr" formatString="YYYYMMDD" >
			
		</mx:DateFormatter>
		<mx:DateFormatter id="timestr" formatString="JJNN" >
			
		</mx:DateFormatter>
	</fx:Declarations>
	<s:BorderContainer width="100%" height="20" borderVisible="false" backgroundAlpha="0" >
		<s:layout>
			<s:HorizontalLayout paddingLeft="10">
				
			</s:HorizontalLayout>
		</s:layout>
		<s:Label id="datestr" fontWeight="bold" fontSize="15" text="{date.substr(6,2)}" textAlign="center" height="100%" verticalAlign="middle">
			
		</s:Label>
		<s:Label fontSize="13" text="{date.substr(4,2)+'月'}" visible="{date.substr(6,2)=='01'?true:false}" textAlign="center" height="100%" verticalAlign="middle">
			
		</s:Label>
		
	</s:BorderContainer>
	<s:BorderContainer id="scheduleList" width="100%" height="100%" borderVisible="false"  backgroundAlpha="0">
		<s:layout>
			<s:VerticalLayout paddingLeft="3" gap="0">
				
			</s:VerticalLayout>
		</s:layout>
		
	</s:BorderContainer>
	
		
</s:BorderContainer>
