<?xml version="1.0" encoding="utf-8"?>
<s:TitleWindow xmlns:fx="http://ns.adobe.com/mxml/2009"
               xmlns:s="library://ns.adobe.com/flex/spark"
               xmlns:mx="library://ns.adobe.com/flex/mx" xmlns:uicontrol="uicontrol.*" xmlns:conobj="uicontrol.conobj.*"
               width="450" height="500"
               title="注册用户" close="closeWin()">
	<fx:Script>
		<![CDATA[
			import httpcontrol.HttpServiceUtil;
			import httpcontrol.RemoteUtil;

            import mx.collections.ArrayCollection;

            import mx.controls.Alert;
            import mx.events.FlexEvent;
            import mx.managers.PopUpManager;
			import mx.rpc.AbstractOperation;
			import mx.rpc.events.ResultEvent;
			
			import util.ToolUtil;
			import util.UserUtil;
			
			
			public function closeWin():void{
				PopUpManager.removePopUp(this);
			}

			public function save():void{
				if(username.text==""||truename.text==""||password.text==""||rpassword.text==""||orgname.text==""){
					Alert.show("请填写完整信息。 用户名、密码、姓名、组织名称必须填写","提示");
					return;
				}
				if(this.password.text==""||this.password.text!=this.rpassword.text){
					Alert.show("密码和确认密码要一致。","提示");
					return;
				}
				var obj:Object=new Object();
				obj.username=username.text;
				obj.truename = truename.text;
				obj.password = password.text;
				obj.name = orgname.text;
				obj.userhead = headSelectArray.selectedIcon();
				obj.icon = orgHeadSelectArray.selectedIcon();

				
				HttpServiceUtil.getCHTTPServiceAndResult("/riliusers/regUser",refresh,"POST").send(obj);
					
				
			}
			public function refresh(r:Object,e:ResultEvent):void{
				if(r.success){
					ToolUtil.sessionUserRefresh(ToolUtil.currentUserFun);
					closeWin();
				}else{
//					Alert.show("修改密码失败","提示");
				}
			}

        public function foucePass(obj:Object):void{
            obj.setFocus();
        }
		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
        <conobj:HeadSelectArray id="headSelectArray"></conobj:HeadSelectArray>
        <conobj:HeadSelectArray id="orgHeadSelectArray"></conobj:HeadSelectArray>
	</fx:Declarations>
	
	<s:Form width="100%" id="form" >
		
		<s:FormItem label="用户名:" textAlign="right">
			<s:layout>
				<s:HorizontalLayout gap="5"/>
			</s:layout>
			<s:TextInput id="username" prompt="电子邮件" width="200"  text="" tabIndex="1" enter="foucePass(truename)">
				
			</s:TextInput>
			<s:Label text="电子邮件作为用户名" color="red" />
		</s:FormItem>
		<s:FormItem label="姓名:" textAlign="right">
			<s:layout>
				<s:HorizontalLayout gap="5"/>
			</s:layout>
			<s:TextInput id="truename"   width="200"  tabIndex="2" enter="foucePass(password)">
				
			</s:TextInput>
			<s:Label text="昵称" color="red" />
		</s:FormItem>
        <s:FormItem label="头像:" textAlign="right">
            <s:layout>
                <s:HorizontalLayout gap="5"/>
            </s:layout>
            <uicontrol:IconButton iconurl="/static/smalloaicon/9.png" selected="true" headSelectArray="{headSelectArray}"></uicontrol:IconButton>
            <uicontrol:IconButton iconurl="/static/smalloaicon/20.png" headSelectArray="{headSelectArray}"></uicontrol:IconButton>
            <uicontrol:IconButton iconurl="/static/smalloaicon/23.png" headSelectArray="{headSelectArray}"></uicontrol:IconButton>
            <uicontrol:IconButton iconurl="/static/smalloaicon/24.png" headSelectArray="{headSelectArray}"></uicontrol:IconButton>
            <uicontrol:IconButton iconurl="/static/smalloaicon/30.png" headSelectArray="{headSelectArray}"></uicontrol:IconButton>
            <uicontrol:IconButton iconurl="/static/smalloaicon/40.png" headSelectArray="{headSelectArray}"></uicontrol:IconButton>
        </s:FormItem>
		<s:FormItem label="密码:" textAlign="right">
			<s:layout>
				<s:HorizontalLayout gap="5"/>
			</s:layout>
			<s:TextInput id="password" displayAsPassword="true"  width="200"  tabIndex="3"  enter="foucePass(rpassword)">
				
			</s:TextInput>
			<s:Label text="*" color="red" />
		</s:FormItem>
		<s:FormItem label="确认密码:" textAlign="right">
			<s:layout>
				<s:HorizontalLayout gap="5"/>
			</s:layout>
			<s:TextInput id="rpassword" displayAsPassword="true"  width="200"  tabIndex="4" enter="foucePass(orgname)">
				
			</s:TextInput>
			<s:Label text="*" color="red" />
		</s:FormItem>

		<s:FormItem label="组织名称:" textAlign="right">
			<s:layout>
				<s:HorizontalLayout gap="5"/>
			</s:layout>
			<s:TextInput id="orgname"  width="200"  tabIndex="5">
				
			</s:TextInput>
			<s:Label text="公司或团队名称" color="red" />
		</s:FormItem>

		<s:FormItem label="组织图标:" textAlign="right">
            <s:layout>
                <s:HorizontalLayout gap="5"/>
            </s:layout>
            <uicontrol:IconButton iconurl="/static/smalloaicon/5.png" selected="true" headSelectArray="{orgHeadSelectArray}"></uicontrol:IconButton>
            <uicontrol:IconButton iconurl="/static/smalloaicon/12.png" headSelectArray="{orgHeadSelectArray}"></uicontrol:IconButton>
            <uicontrol:IconButton iconurl="/static/smalloaicon/15.png" headSelectArray="{orgHeadSelectArray}"></uicontrol:IconButton>
            <uicontrol:IconButton iconurl="/static/smalloaicon/26.png" headSelectArray="{orgHeadSelectArray}"></uicontrol:IconButton>
            <uicontrol:IconButton iconurl="/static/smalloaicon/34.png" headSelectArray="{orgHeadSelectArray}"></uicontrol:IconButton>
            <uicontrol:IconButton iconurl="/static/smalloaicon/36.png" headSelectArray="{orgHeadSelectArray}"></uicontrol:IconButton>
		</s:FormItem>
		

		<s:FormItem>
				<s:layout>
					<s:HorizontalLayout gap="10"/>
				</s:layout>
				<s:Button label="提交" click="save()" chromeColor="red" color="#ffffff" height="25"  tabIndex="10">
					
				</s:Button>
				<s:Button label="放弃" click="closeWin()" chromeColor="#ffffff" color="#000000" height="25">
					
				</s:Button>
		</s:FormItem>
	</s:Form>
</s:TitleWindow>
