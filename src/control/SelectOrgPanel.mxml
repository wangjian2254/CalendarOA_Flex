<?xml version="1.0" encoding="utf-8"?>
<s:TitleWindow xmlns:fx="http://ns.adobe.com/mxml/2009"
               xmlns:s="library://ns.adobe.com/flex/spark"
               xmlns:mx="library://ns.adobe.com/flex/mx" xmlns:uicontrol="uicontrol.*" xmlns:conobj="uicontrol.conobj.*"
               width="430" height="500"   creationComplete="init()"
               title="选择工作的组织" close="closeWin()">
	<fx:Script>
		<![CDATA[
        import events.ListClickEvent;

        import httpcontrol.HttpServiceUtil;

            import mx.collections.ArrayCollection;

            import mx.core.FlexGlobals;
            import mx.managers.PopUpManager;
			import mx.rpc.events.ResultEvent;
			
			import util.ToolUtil;

            [Bindable]
            private var orglist:ArrayCollection;
			public function closeWin():void{
				PopUpManager.removePopUp(this);
			}

            private function init():void{

                //getOrgByFlag
                var obj:Object=new Object();
                obj.flag=ToolUtil.joinOrgFlag;
                HttpServiceUtil.getCHTTPServiceAndResult("/riliusers/getAllOrg",getAllOrgResult,"POST").send(obj);


                this.x = (FlexGlobals.topLevelApplication.width - this.width) / 2;
                this.y = (FlexGlobals.topLevelApplication.height - this.height) / 2;
            }

            private function getAllOrgResult(result:Object, e:ResultEvent):void{
                orglist = new ArrayCollection(result.result as Array);
            }





			public function listItemClick_handler(e:ListClickEvent):void{

				var obj:Object=new Object();
                obj.orgid = e.data.id;
				HttpServiceUtil.getCHTTPServiceAndResult("/riliusers/selectedOrg",refresh,"POST").send(obj);
			}
			public function refresh(r:Object,e:ResultEvent):void{
				if(r.success){
					ToolUtil.sessionUserRefresh(ToolUtil.currentUserFun);
					closeWin();
				}else{
//					Alert.show("修改密码失败","提示");
				}
			}

		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->

	</fx:Declarations>
    <uicontrol:AddressList dataProvider="{orglist}"
                           borderVisible="false" width="100%" height="100%"
                           itemRenderer="uicontrol.renderer.OrgItemRenderer"
                           listItemClick="listItemClick_handler(event)">

    </uicontrol:AddressList>
</s:TitleWindow>
